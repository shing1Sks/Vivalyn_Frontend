# Changelog

## [7] agentspace-management-system — 2026-02-21

**Why:** Users needed a full invite-based membership system — admins invite people by email, invitees get a branded email, click the link, sign in if needed, and accept to join. Admins needed a settings panel to manage members and invites. Users needed an inbox for invites sent to them.

**What:** Added the complete frontend layer: settings panel (members + invites management), inbox panel, invite accept page, API functions, header updates, and auth redirect support. Bell icon highlights only when there are pending invites.

**Changes:**
- `src/lib/api.ts` — added `AgentSpaceMember` and `Invite` interfaces; added 9 API functions: `fetchAgentSpaceMembers`, `changeAgentSpaceMemberRole`, `removeAgentSpaceMember`, `fetchAgentSpaceInvites`, `createInvite`, `revokeInvite`, `fetchInboxInvites`, `fetchInviteDetails` (no auth token), `acceptInvite`
- `src/App.tsx` — added `/invite/:inviteId` route pointing to new `InviteAccept` page
- `src/pages/Auth.tsx` — reads `?next=` query param via `useLocation`; after successful login/signup navigates to `next` if present instead of always going to `/agent-space`
- `src/pages/InviteAccept.tsx` — **new**; public page at `/invite/:inviteId`; fetches invite details without auth; handles states: loading, not found, expired/revoked, already accepted, pending+not-logged-in ("Sign in to accept" → `/auth?next=/invite/{id}`), pending+logged-in+email-mismatch, pending+logged-in+match (Accept button); on accept auto-redirects to `/agent-space` after 2 s
- `src/components/agentspace/AgentSpaceSettingsPanel.tsx` — **new**; right slide-out panel (max-w-440, `x: 100%→0` animation); Members tab with `MemberRow` (role dropdown + remove button, self-actions disabled) and Invites tab with send form (email + role select) and `InviteRow` (status badge + revoke button); admin-only
- `src/components/agentspace/InboxPanel.tsx` — **new**; right slide-out panel (max-w-420); `InviteCard` per invite with status badge, `timeAgo` timestamp, and Accept button for pending valid invites; on accept updates local state + calls `refetchSpaces()`; exports `usePendingInviteCount()` hook for the header badge
- `src/components/agentspace/AgentSpaceHeader.tsx` — added `onSettingsClick` and `onInboxClick` props; added `usePendingInviteCount` hook; bell button color is conditional (`pendingCount > 0` → indigo, else gray) with dot badge when pending; Settings button enabled only when `activeSpace?.role === 'admin'`
- `src/pages/AgentSpace.tsx` — added `settingsOpen` and `inboxOpen` state; wired both props to `AgentSpaceHeader`; renders `<AgentSpaceSettingsPanel>` and `<InboxPanel>`

---

## [6] profile-name-auth-hardening — 2026-02-20

**Why:** Three related gaps needed closing: (1) the signup form had no name field so email-signup users had empty `name` in their profile; (2) the `UserProfile` type didn't include `name`/`email` even though the backend now returns them; (3) a deleted Supabase user still appeared logged in because `getSession()` reads localStorage without server validation, and a stale agentspace ID in localStorage could cause the app to render a phantom profile. Additionally, first-time users could briefly see the "no agentspace" empty state due to a race between the profile-creation fetch and the agentspace fetch.

**What:** Added a name field to the signup form (hidden in login mode). Hardened the auth flow so a stale or invalid session is automatically cleared on the first API call. Sequenced agentspace loading to wait for profile fetch completion (profile creation also creates the default agentspace). Replaced the empty-agentspace CTA with a "Setting up your agentspace…" loader that auto-retries as a safety net.

**Changes:**
- `src/lib/api.ts` — added `name` and `email` to `UserProfile` interface; added `ApiError` class (extends `Error`, carries `status: number`); `fetchProfile` now throws `ApiError` instead of a plain `Error` so callers can inspect the HTTP status
- `src/context/AuthContext.tsx` — `signUpWithEmail` accepts a third `name` param; passes it as `options.data.full_name` to `supabase.auth.signUp` so name lands in `user_metadata` for profile creation to pick up
- `src/context/ProfileContext.tsx` — destructures `signOut` from `useAuth`; on `fetchProfile` failure, checks `e instanceof ApiError && e.status === 401` and calls `signOut()` to clear the stale localStorage session and redirect to auth; other errors still console-error only
- `src/context/AgentSpaceContext.tsx` — imports `useProfile`; `loadSpaces` bails early while `profileLoading` is true so agentspace fetch only fires after profile creation (and its default agentspace creation) completes; `profileLoading` added to `useCallback` deps
- `src/pages/Auth.tsx` — added `name` state; Name input field rendered only when `mode === 'signup'` (above Email); `switchMode` resets `name`; `signUpWithEmail` called with `name` as third arg
- `src/pages/AgentSpace.tsx` — `AgentSpaceContent` now reads `spaces` and `refetchSpaces` from context; added `useRef` retry counter (`retryCount`, max 5) with a `useEffect` that calls `refetchSpaces()` after 1500 ms whenever spaces are empty post-load (safety net for edge cases); replaced "You have no AgentSpaces / Create your first" empty state with a centered `Loader2` spinner + "Setting up your agentspace…" text

---

## [5] agentspace-management — 2026-02-20

**Why:** Users needed a workspace UI to organise agents. Each user gets one default AgentSpace on first login; they can create more. The app needed a dedicated in-app environment (no landing nav/footer) with a Supabase-style switcher so users can move between spaces.

**What:** Added the full AgentSpace management layer: API functions, a scoped context with localStorage persistence, a Supabase-style space switcher, a create-space modal, a custom header, and a redesigned AgentSpace page. The switcher lives in the top-left of a new per-page header; the last-used space is restored from `localStorage` on every visit.

**Changes:**
- `src/lib/api.ts` — added `AgentSpace` interface, `CreateAgentSpacePayload` interface, `fetchAgentSpaces(token)` (`GET /api/v1/agentspaces`), `createAgentSpace(token, payload)` (`POST /api/v1/agentspaces`); error detail extracted from FastAPI `detail` field on failure
- `src/context/AgentSpaceContext.tsx` — new; `AgentSpaceProvider` scoped to the AgentSpace page only (not global); fetches spaces on `session.access_token` change; restores active space from `localStorage` key `vivalyn_last_agentspace_id`, falling back to `spaces[0]`; exposes `spaces`, `activeSpace`, `spacesLoading`, `spacesError`, `switchSpace(id)`, `createSpace(payload)`, `refetchSpaces()` via `useAgentSpace()` hook; `createSpace` appends optimistically and switches immediately
- `src/components/agentspace/AgentSpaceSwitcher.tsx` — new; trigger button shows active space name with animated rotating `ChevronDown`; `AnimatePresence` panel (`opacity 0→1, y -4→0`, 150 ms) lists all spaces with an `Orbit` icon, active space highlighted in `indigo-50` with a `Check` icon; "New AgentSpace" button at the bottom in indigo; outside-click closes via `useRef + mousedown`
- `src/components/agentspace/CreateAgentSpaceModal.tsx` — new; `AnimatePresence` modal with blurred backdrop and scale+translate entrance (200 ms); single name input with `maxLength=80`, `autoFocus`; `Create` button disabled while name empty or submitting, shows `Loader2` spinner; error message displayed below input; resets state on close
- `src/components/agentspace/AgentSpaceHeader.tsx` — new; 64 px sticky header replacing the landing `Header` on this route; left side: logo button (`./icon.png` + "Vivalyn" wordmark) navigating to `/` on click, `/` separator, `AgentSpaceSwitcher`; right side: `Settings` icon (disabled, `opacity-40`, `cursor-not-allowed`, title "Settings (coming soon)") + `UserAvatar sm` with sign-out dropdown
- `src/pages/AgentSpace.tsx` — replaced; two-component pattern: outer `AgentSpace` handles auth guard and wraps `AgentSpaceProvider`; inner `AgentSpaceContent` consumes context, owns `createOpen` state; renders loading spinner, error message, active-space name with role subtitle, or empty-state CTA depending on context state; `staggerContainer + fadeInUp` animation on main content; `CreateAgentSpaceModal` always mounted, toggled by `createOpen`

---

## [4] profile-api-integration — 2026-02-19

**Why:** The avatar in the header and agent-space page was a hardcoded indigo circle with an email initial. Needed a real profile backed by the backend — showing the OAuth provider photo for Google/Microsoft users, and a unique gradient avatar for email users.

**What:** Added a backend API layer and a `ProfileContext` that fetches-or-creates the user's profile on login. Built a reusable `UserAvatar` component that renders the provider photo if available, falling back to the stored gradient with the email initial. Wired it into the header dropdown and the agent-space welcome screen.

**Changes:**
- `.env.example` — added `VITE_BACKEND_URL=http://localhost:8000`
- `src/lib/api.ts` — new; `fetchProfile(accessToken)` — typed fetch to `GET /api/v1/profile/me` using the Supabase access token as a Bearer header; exports `UserProfile` interface
- `src/context/ProfileContext.tsx` — new; `ProfileProvider` watches `session.access_token` from `AuthContext`, calls `fetchProfile` on login, clears on sign-out; exposes `profile` and `profileLoading` via `useProfile()` hook
- `src/components/ui/UserAvatar.tsx` — new; renders `<img referrerPolicy="no-referrer">` when `profile_pic_link` exists, otherwise a `<div>` with the stored CSS gradient and the first initial of the email; supports `sm` / `md` / `lg` sizes
- `src/main.tsx` — added `ProfileProvider` inside `AuthProvider`
- `src/components/layout/Header.tsx` — replaced hardcoded indigo avatar button with `UserAvatar size="sm"`; added `useProfile()` import
- `src/pages/AgentSpace.tsx` — replaced hardcoded indigo avatar `motion.div` with `UserAvatar size="md"`; added `useProfile()` import

---

## [3] supabase-auth — 2026-02-18

**Why:** The app needed user authentication to gate CTA actions (sign up, sign in) and prepare for user-specific features like a dashboard.

**What:** Added Supabase authentication supporting email/password, Google OAuth, and Microsoft Azure OAuth. Introduced React Router for multi-page routing, a global auth context, a login/signup page with animated form and OAuth buttons, and a simple protected dashboard. Header and CTA buttons now reflect auth state — showing "Sign in" when logged out and a user avatar dropdown when logged in.

**Changes:**
- `.env.example` — new; Supabase URL and anon key placeholders
- `src/lib/supabase.ts` — new; Supabase client singleton with env var validation
- `src/context/AuthContext.tsx` — new; React Context providing user/session state, email sign-in/sign-up, Google/Microsoft OAuth, sign-out, and `useAuth()` hook
- `src/pages/Landing.tsx` — new; extracted landing page content from App.tsx
- `src/pages/Auth.tsx` — new; login/signup page with tab toggle, Google & Microsoft OAuth buttons, email/password form, Framer Motion animations, subtle gradient background
- `src/pages/Dashboard.tsx` — new; protected welcome page with user avatar, email display, and sign-out
- `src/App.tsx` — replaced section composition with React Router routes (`/`, `/auth`, `/dashboard`)
- `src/main.tsx` — wrapped app with `BrowserRouter` and `AuthProvider`
- `src/components/layout/Header.tsx` — "Sign in" button navigates to `/auth`; logged-in users see initial avatar with dropdown (email + sign out); nav links prepend `/` when off landing page
- `src/sections/Hero.tsx` — "Request pilot pricing" renamed to "Get started free", navigates to `/auth`
- `src/sections/CTASection.tsx` — primary button renamed to "Get started" with auth gate; secondary button remains "Book a demo"

---

## [2] pricing-section — 2026-02-16

**Why:** Landing page needed a pricing section to communicate plan options for both Indian and international users, with a free trial available on a demo-request basis.

**What:** Added a Pricing section with an India/International region toggle, 5 pricing tiers (Trial, Starter, Growth, Pro, Business), and animated card transitions. Pro plan is highlighted as "Most Popular". Trial tier uses a "Request Demo" CTA instead of direct signup.

**Changes:**
- `src/lib/constants.ts` — added `PricingPlan` interface, `PRICING_PLANS_IN` and `PRICING_PLANS_INTL` data arrays
- `src/sections/Pricing.tsx` — new; region toggle, 5-column pricing card grid with AnimatePresence transitions, per-session cost, bonus credits, and "Contact sales" footer
- `src/App.tsx` — added `<Pricing />` section between ReportPreview and SocialProof

---

## [1] landing-page-v1 — 2026-02-16

**Why:** Vivalyn needed a public-facing landing page to communicate the product value prop (AI training & assessment agents), capture demo leads, and establish brand presence following the YC-grade clean SaaS design system defined in `UI.md`.

**What:** Built the complete landing page from a fresh React + Vite setup. Configured Tailwind CSS v4, Framer Motion, Lucide React, and Inter font. Created 6 reusable UI components, 2 layout components, and 9 landing page sections. Hero section features animated mock product UI cycling through 3 scenarios (Sales, Support, Education) with progress bar tabs.

**Changes:**
- `vite.config.ts` — added `@tailwindcss/vite` plugin
- `index.html` — added Inter font preconnect, SEO meta, updated title
- `src/index.css` — replaced with Tailwind v4 import + `@theme` for Inter font
- `src/App.tsx` — rewritten to compose all landing page sections
- `src/App.css` — deleted (all styling via Tailwind now)
- `src/lib/motion.ts` — new; shared Framer Motion variants (fadeInUp, staggerContainer)
- `src/lib/constants.ts` — new; all static data (nav links, features, steps, FAQs, metrics, testimonials, footer links)
- `src/components/ui/Button.tsx` — new; Primary/Secondary/Ghost variants
- `src/components/ui/Badge.tsx` — new; indigo-50 pill badge
- `src/components/ui/Card.tsx` — new; bordered card with hover lift
- `src/components/ui/SectionWrapper.tsx` — new; max-width + section padding wrapper
- `src/components/ui/Logo.tsx` — new; "Vivalyn" text logo with indigo icon
- `src/components/ui/Accordion.tsx` — new; FAQ expand/collapse with AnimatePresence
- `src/components/layout/Header.tsx` — new; sticky 72px header with blur backdrop, nav links, mobile hamburger
- `src/components/layout/Footer.tsx` — new; 4-column links grid + copyright
- `src/sections/Hero.tsx` — new; 2-column hero with animated scenario cycling (Sales/Support/Education), mock report card, transcript, progress bar tabs
- `src/sections/ProblemStatement.tsx` — new; centered narrow copy block
- `src/sections/SolutionSummary.tsx` — new; "What we do" section
- `src/sections/FeatureGrid.tsx` — new; 3-column card grid with Coming Soon badges
- `src/sections/HowItWorks.tsx` — new; 3-step horizontal timeline with connector line
- `src/sections/ReportPreview.tsx` — new; mock assessment report + feature bullet list
- `src/sections/SocialProof.tsx` — new; metrics banner, partner logos, testimonial cards
- `src/sections/FAQ.tsx` — new; 5 accordion items
- `src/sections/CTASection.tsx` — new; indigo-600 rounded container with inverted CTA
